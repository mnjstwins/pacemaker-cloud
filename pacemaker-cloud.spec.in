Name: pacemaker-cloud
Summary: The Pacemaker Cloud Policy Engine
Version: @version@
Release: 1%{?dist}
License: GPLv2+
Group: System Environment/Base
URL: http://github.com/cloud-policy-engine
Source0: http://pacemaker-cloud.org/downloads/%{name}-%{version}/%{name}-%{version}.tar.gz

Requires: python-daemon python-qmf qpid-cpp-server
Requires: oz > 0.5.0-1

# Note libtool-ltdl-devel is required because of redhat.com bugzilla BZ #705212
BuildRequires: autoconf automake glib2-devel dbus-glib-devel libxml2-devel libqb-devel pacemaker-libs-devel libtool-ltdl-devel qmf-devel libxslt-devel systemd-units libmicrohttpd-devel
BuildRoot: %(mktemp -ud %{_tmppath}/%{name}-%{version}-%{release}-XXXXXX)

%prep
%setup -q -n %{name}-%{version}

%build
./autogen.sh
./configure --libdir=%{_libdir}

make %{_smp_mflags}

%install
rm -rf %{buildroot}

make install DESTDIR=%{buildroot}
# this is installed by make install - but rpm picks it up in a different way
rm -f %{buildroot}/usr/share/doc/pacemaker-cloud/COPYING

%clean
rm -rf %{buildroot}

%description
This package contains the Pacemaker Cloud Policy Engine services, command-line
tools, and man pages.

%post
if [ $1 -eq 1 ] ; then
	systemctl --system daemon-reload || :
fi

%preun
if [ $1 -eq 0 ]; then
	systemctl --system daemon-reload || :
fi

%files
%defattr(-,root,root,-)
%doc COPYING
%{_sbindir}/cped
%{_sbindir}/dped
%{_sysconfdir}/init/pcloud-dped.conf
%{_unitdir}/pcloud-dped@.service
%{_unitdir}/pcloud-cped.service
%{_unitdir}/pcloud-vmlauncher.service
%{_unitdir}/pcloud-qpidd.service
%dir %attr(0755, root, root) %{_datadir}/pacemaker-cloud
%{_datadir}/pacemaker-cloud/cf2pe.xsl
%{_datadir}/pacemaker-cloud/resource_templates/
%dir %attr(0755, root, root) %{_localstatedir}/lib/pacemaker-cloud/
%dir %attr(0755, root, root) %{_localstatedir}/lib/pacemaker-cloud/assemblies
%dir %attr(0755, root, root) %{_localstatedir}/lib/pacemaker-cloud/jeos
%{_localstatedir}/lib/pacemaker-cloud/assemblies/assy1.tdl
%{_localstatedir}/lib/pacemaker-cloud/assemblies/assy1-F14.tdl
%{_localstatedir}/lib/pacemaker-cloud/assemblies/assy1-F15.tdl
%{_localstatedir}/lib/pacemaker-cloud/assemblies/assy1-F16.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F14-x86_64-jeos-assembly.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F14-x86_64-jeos.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F15-x86_64-jeos-assembly.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F15-x86_64-jeos.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F16-x86_64-jeos-assembly.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/F16-x86_64-jeos.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/rhel61-x86_64-jeos-assembly.tdl
%{_localstatedir}/lib/pacemaker-cloud/jeos/rhel61-x86_64-jeos.tdl
%{_bindir}/pcloudsh
%{_bindir}/vmlauncher
%{python_sitelib}/pcloudsh/*
%{_mandir}/man1/cped.1*
%{_mandir}/man1/dped.1*
%{_mandir}/man1/vmlauncher.1*
%{_mandir}/man1/pcloudsh.1*
%{_mandir}/man8/pacemaker_cloud_overview.8*
%{_mandir}/man8/pacemaker_cloud_example.8*

%changelog
* @date@ Autotools generated version <nobody@nowhere.org> - @version@-1
- Autotools generated version
